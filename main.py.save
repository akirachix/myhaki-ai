import chromadb
from chromadb.config import Settings
from fastapi import FastAPI
from pydantic import BaseModel

# Connect to your local Chroma database using proper Settings
client = chromadb.Client(Settings(persist_directory="./chroma"))
collection = client.get_or_create_collection("cases")

app = FastAPI()

class CaseInput(BaseModel):
    case_description: str
    trial_date: str

@app.post("/predict/")
def predict_case(data: CaseInput):
    results = collection.query(
        query_texts=[data.case_description],
        n_results=3
    )
    return {"input": data.dict(), "similar_cases": results}

